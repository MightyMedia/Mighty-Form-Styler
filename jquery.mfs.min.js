/*
 * Mighty Form Styler for jQuery
 * Replaces your form select element for a html dropdown list which you can easily style with css.
 * Examples and documentation at: http://www.binkje.nl/mfs
 * 
 * Copyright (c) 2012-2014 Bas van den Wijngaard
 * Version: 1.0.8
 * Licensed under the MIT License:
 * https://github.com/MightyMedia/Mighty-Form-Styler/blob/master/LICENSE.txt
 *
 * Requires jQuery 1.7 or later
 * 
 * Usage: $('#myForm').mfs(options);    - Enables the magic for your form, see available options below
 *        $('#myForm').mfs('refresh');  - Refreshes the styled selects (e.g. when you updated the select via ajax)
 *        $('#myForm').mfs('destroy');  - Removes the magic from your form
 *
 * options = {
 *      'dropdownHandle'    : '<i class="icon-chevron-down"></i>', // - Alternative HTML to use in the handle (i.e. fontawesome icons)
 *      'enableScroll'      : false,        // Set to true to enable scrolling in dropdown list
 *      'maxHeight'         : 200,          // Set the max height for the dropdown list in pixels (enableScroll needs to be set to true)
 *      'autoWidth'         : false,        // Set to true to adjust dropdown list width to widest option
 *      'disableTouch'      : false         // Set to true to use native select dropdown on mobile and touch devices
 *      'multipleTitle'     : 'selected'    // Set the title used for the selected option 'x selected', defaults to 'selected'
 *      'multipleTitleNone  : false         // Set alternative title for selected option on multi selects when no options are selected
 *      'mutlipleAutoClose  : true          // Set to false to keep a multi select open when selecting an option
 *           }
 *
 */(function(e,t,n,r){"use_strict";var i=!1,s=!1,o=!1,u="",a="&nbsp;",f=/Android|webOS|iPad|iPhone/i.test(navigator.userAgent),l=function(t,n){var r=t.find("select"),o=r.find("option"),l=t.find("a.mfs-selected-option"),c=t.find("ul.mfs-options"),h=c.find("li.mfs-option"),d=c.find("a");c.hide();i=!1;u="";if(s.disableTouch===!0&&f===!0){l.click(function(){r.focus();return!1});r.blur(function(){p(t)})}else l.click(function(){var t=e("ul.mfs-options");if(c.is(":visible")){c.hide();i=!1;u=""}else{h.removeClass("active");t.hide();c.show();var n=c.find("li.mfs-option.selected");n.length>0?n.addClass("active"):c.find("li.mfs-option:first-child").addClass("active");s.enableScroll===!0&&v(c);i=c}e(this).blur();return!1});d.click(function(){a="&nbsp;";s.dropdownHandle!==!1&&(a=s.dropdownHandle);if(n===!1){o.removeAttr("selected");o.eq(e(this).attr("index")).prop("selected","selected");l.html(e(this).text()+"<span>"+a+"</span>");h.removeClass("active").removeClass("selected");e(this).closest("li").addClass("selected")}else{var t=e(this).closest("li");if(t.hasClass("selected")){o.eq(e(this).attr("index")).removeAttr("selected");t.removeClass("selected")}else{o.eq(e(this).attr("index")).prop("selected","selected");t.addClass("selected")}var f=0;r.val()!==null&&(f=r.val().length);l.html('<strong class="count">'+f+"</strong> "+s.multipleTitle+"<span>"+a+"</span>");s.mutlipleTitleNone!==!1&&f===0&&l.html(s.mutlipleTitleNone+"<span>"+a+"</span>")}if(s.mutlipleAutoClose===!0||n===!1){c.hide();i=!1}u="";if(r.selectedIndex!==e(this).attr("index")&&r.onchange){r.selectedIndex=e(this).attr("index");r.onchange()}if(r.selectedIndex!==e(this).attr("index")){r.selectedIndex=e(this).attr("index");r.trigger("change")}n===!0&&r.trigger("change");return!1});h.mouseover(function(){h.removeClass("active");e(this).addClass("active")});r.addClass("mfs-enabled")},c=function(t){var n="notouch";s.disableTouch===!0&&f===!0&&(n="");var r=!1;t.attr("multiple")&&(r=!0);t.after('<div class="mfs-container '+n+'"></div>');var i=t.next("div.mfs-container");t.appendTo(i);var o="",u="",c="",h=0,p="",d="",v=0;r===!0&&(s.mutlipleTitleNone!==!1?o=s.mutlipleTitleNone:o='<strong class="count">0</strong> '+s.multipleTitle);s.autoWidth===!0&&(d='style="white-space: nowrap;"');t.find("> option, optgroup").each(function(){var t=e(this).get(0).tagName.toLowerCase();if(t==="option"){var n="",i=e(this).html();if(o===""||e(this).is(":selected")){r===!1&&(o=i);if(e(this).is(":selected")){n=" selected";v++;r===!0&&(o='<strong class="count">'+v+"</strong> "+s.multipleTitle)}}c+='<li class="mfs-option'+n+'"><a href="#" index="'+h+'"'+d+">"+i+"</a></li>";h++}if(t==="optgroup"){var u=e(this).attr("label"),a='<li class="mfs-optgroup">'+u+"</li>";e(this).find("option").each(function(){var t="",n=e(this).html();if(o===""||e(this).is(":selected")){o=n;e(this).is(":selected")&&(t=" selected")}a+='<li class="mfs-option mfs-optgroup-option'+t+'"><a href="#" index="'+h+'"'+d+">"+n+"</a></li>";h++});c+=a}});s.dropdownHandle!==!1&&(a=s.dropdownHandle);s.enableScroll===!0&&(p="overflow-y:auto;max-height:"+s.maxHeight+"px;");s.autoWidth===!0&&(p="width:auto;min-width:100%;");p.length>0&&(p='style="'+p+'"');u+='<a class="mfs-selected-option" href="#">'+o+"<span>"+a+"</span></a>";u+='<ul class="mfs-options"'+p+">"+c+"</ul>";i.prepend(u);l(i,r)},h=function(e){var t=e.find("select");t.removeClass("mfs-enabled");e.before(t);e.remove()},p=function(e){var t=e.find("select");e.before(t);e.remove();c(t)},d=function(e){o!==!1&&clearTimeout(o);o=setTimeout(function(){u=""},1e3);var t=String.fromCharCode(e);u+=String(t);var n=i.find("a:mfssearch('"+u+"')").filter(":first");if(n.length>0){i.find("li.active").removeClass("active");n.closest("li").addClass("active");v(i)}},v=function(e){if(s.enableScroll===!0){var t=e.find("li.mfs-option.active"),n=t.height(),r=t.position(),i=t.offset(),o=e.height();r.top>s.maxHeight-24?e.scrollTop(e.scrollTop()+i.top-e.offset().top-(o-n)+5):r.top<5&&e.scrollTop(e.scrollTop()+i.top-e.offset().top-5)}},m={init:function(r){s=e.extend({},{refresh:!0,radio:!1,checkbox:!1,dropdownHandle:!1,enableScroll:!1,maxHeight:200,autoWidth:!1,disableTouch:!1,multipleTitle:"selected",mutlipleTitleNone:!1,multipleAutoClose:!0},r);if(this.is("select")){var o=e(this);o.hasClass("mfs-enabled")||c(o)}else this.each(function(){var t=e(this);if(!t.hasClass("mfs-enabled")){var n=t.find("select");n.length>0&&n.each(function(){var t=e(this);t.hasClass("mfs-enabled")||c(t)});t.addClass("mfs-enabled")}});e(t).click(function(){e("ul.mfs-options").hide();i=!1;u=""});e(n).off("keydown.mfs");e(n).on("keydown.mfs",function(t){var n=t.keyCode;if(i===!1||n!==13&&n!==38&&n!==40&&n!==27){if(i!==!1&&n!==37&&n!==39&&n!==16&&n!==17&&n!==18&&n!==91){t.preventDefault();d(n)}}else{var r=i.find("li.mfs-option.active"),s=!1;if(n===38){t.preventDefault();s=r.prevAll(".mfs-option:first");if(s.length>0){s.addClass("active");r.removeClass("active");v(i)}}else if(n===40){t.preventDefault();s=r.nextAll(".mfs-option:first");if(s.length>0){s.addClass("active");r.removeClass("active");v(i)}}else if(n===13)r.find("a").click();else if(n===27){e("ul.mfs-options").hide();i=!1}}})},refresh:function(){i=!1;u="";this.each(function(){var t=e(this).find("select");t.length>0&&t.each(function(){var t=e(this),n=t.closest("div.mfs-container");t.hasClass("mfs-enabled")?n.length>0&&p(n):c(t)})})},destroy:function(){i=!1;u="";this.each(function(){var t=e(this),n=e(this).find("div.mfs-container");n.length>0&&n.each(function(){var t=e(this);h(t)});t.removeClass("mfs-enabled")})}};e.fn.mfs=function(t){if(m[t])return m[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return m.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.mfs")}})(jQuery,window,document);$.extend($.expr[":"],{mfscontains:function(e,t,n){return(e.textContent||e.innerText||"").toLowerCase().indexOf((n[3]||"").toLowerCase())>=0}});$.extend($.expr[":"],{mfssearch:function(e,t,n){var r=n[3].toLowerCase(),i=r.length;return(e.textContent||e.innerText||"").toLowerCase().substr(0,i)===r}});