/*
 * jQuery Mighty Form Styler plugin
 * Replaces your form select element for a html dropdown list which you can easily style with css.
 * Examples and documentation at: http://www.binkje.nl/mfs
 * 
 * Copyright (c) 2013 Bas van den Wijngaard
 * Version: 0.2.4
 * Licensed under the MIT License:
 * http://www.binkje.nl/mfs/license
 *
 * Requires jQuery 1.7 or later
 * 
 * Usage: $('#myForm').mfs(options);   - Enables the magic for your form, see available options below
 *        $('#myForm').mfs('refresh'); - Refreshes the styled selects (e.g. when you updated the select via ajax)
 *        $('#myForm').mfs('destroy'); - Removes the magic from your form
 *
 * options = {
 *            'dropdownHandle' : '<i class="icon-arrow-down"></i>' //	- Alternative HTML to use in the handle (i.e. fontawesome icons)
 *           }
 */(function(e){var t=!1,n=!1,r=!1,i="",s=function(t){t.after('<div class="mfs-container"></div>');var r=t.next("div.mfs-container");t.appendTo(r);var i="",s="&nbsp;",o="",u="",f=0;t.find("> option, optgroup").each(function(){var t=e(this).get(0).tagName.toLowerCase();if(t=="option"){var n="",r=e(this).html();if(i===""||e(this).is(":selected")){i=r;e(this).is(":selected")&&(n=" selected")}u+='<li class="mfs-option'+n+'"><a href="#" index="'+f+'">'+r+"</a></li>";f++}if(t=="optgroup"){var s=e(this).attr("label");mfsOptGroupHtml='<li class="mfs-optgroup">'+s+"</li>";e(this).find("option").each(function(){var t="",n=e(this).html();if(i===""||e(this).is(":selected")){i=n;e(this).is(":selected")&&(t=" selected")}mfsOptGroupHtml+='<li class="mfs-option mfs-optgroup-option'+t+'"><a href="#" index="'+f+'">'+n+"</a></li>";f++});u+=mfsOptGroupHtml}});n.dropdownHandle!==!1&&(s=n.dropdownHandle);o+='<a class="mfs-selected-option" href="#">'+i+"<span>"+s+"</span></a>";o+='<ul class="mfs-options">'+u+"</ul>";r.prepend(o);a(r)},o=function(e){var t=e.find("select");t.removeClass("mfs-enabled");e.before(t);e.remove()},u=function(e){var t=e.find("select");e.before(t);e.remove();s(t)},a=function(r){var s=r.find("select"),o=s.find("option"),u=r.find("a.mfs-selected-option"),a=r.find("ul.mfs-options"),f=a.find("li.mfs-option"),l=a.find("a");a.hide();t=!1;i="";u.click(function(){var n=e("ul.mfs-options");if(a.is(":visible")){a.hide();t=!1;i=""}else{f.removeClass("active");n.hide();a.show();var r=a.find("li.mfs-option.selected");r.length>0?r.addClass("active"):a.find("li.mfs-option:first-child").addClass("active");t=a}e(this).blur();return!1});l.click(function(){f.removeClass("active").removeClass("selected");e(this).closest("li").addClass("selected");mfsHandle="&nbsp;";n.dropdownHandle!==!1&&(mfsHandle=n.dropdownHandle);u.html(e(this).text()+"<span>"+mfsHandle+"</span>");o.removeAttr("selected");o.eq(e(this).attr("index")).prop("selected","selected");a.hide();t=!1;i="";if(s.selectedIndex!=e(this).attr("index")&&s.onchange){s.selectedIndex=e(this).attr("index");s.onchange()}if(s.selectedIndex!=e(this).attr("index")){s.selectedIndex=e(this).attr("index");s.trigger("change")}return!1});f.mouseover(function(){f.removeClass("active");e(this).addClass("active")});s.addClass("mfs-enabled")},f=function(e){var t=e.find("select"),n=t.find("option"),r=e.find("a.mfs-selected-option"),i=e.find("ul.mfs-options"),o=i.find("li"),u=i.find("a");t.on("change.mfsEnableRefresh",function(){e.before(t);e.remove();s(t)})},l=function(e){r!==!1&&clearTimeout(r);r=setTimeout(function(){i=""},1e3);var n=String.fromCharCode(e);i+=String(n);var s=t.find("a:mfssearch('"+i+"')").filter(":first");if(s.length>0){t.find("li.active").removeClass("active");s.closest("li").addClass("active")}},c={init:function(r){n=e.extend({refresh:!0,radio:!1,checkbox:!1,dropdownHandle:!1},r);this.each(function(){var t=e(this),n=t.find("select");n.length>0&&n.each(function(){var t=e(this);t.hasClass("mfs-enabled")||s(t)})});e(window).click(function(){e("ul.mfs-options").hide();t=!1;i=""});e(document).keydown(function(n){var r=n.keyCode;if(t===!1||r!=13&&r!=38&&r!=40&&r!=27)t!==!1&&r!=37&&r!=39&&r!=16&&r!=17&&r!=18&&r!=91&&l(r);else{var i=t.find("li.mfs-option.active"),s=!1;if(r==38){n.preventDefault();s=i.prevAll(".mfs-option:first");if(s.length>0){s.addClass("active");i.removeClass("active")}}else if(r==40){n.preventDefault();s=i.nextAll(".mfs-option:first");if(s.length>0){s.addClass("active");i.removeClass("active")}}else if(r==13)i.find("a").click();else if(r==27){e("ul.mfs-options").hide();t=!1}}})},refresh:function(){t=!1;i="";this.each(function(){var t=e(this).find("div.mfs-container");t.length>0&&t.each(function(){var t=e(this);u(t)})})},destroy:function(){t=!1;i="";this.each(function(){var t=e(this).find("div.mfs-container");t.length>0&&t.each(function(){var t=e(this);o(t)})})}};e.fn.mfs=function(t){if(c[t])return c[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return c.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.mfs")}})(jQuery);$.extend($.expr[":"],{mfscontains:function(e,t,n,r){return(e.textContent||e.innerText||"").toLowerCase().indexOf((n[3]||"").toLowerCase())>=0}});$.extend($.expr[":"],{mfssearch:function(e,t,n,r){var i=n[3].toLowerCase(),s=i.length;return(e.textContent||e.innerText||"").toLowerCase().substr(0,s)==i}});